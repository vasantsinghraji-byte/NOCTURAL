<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Note: X-Frame-Options should be set via HTTP headers in production -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' http://localhost:5000 https://*.onrender.com https://*.railway.app;">
    <meta name="description" content="Nocturnal - A modern healthcare staffing platform connecting professionals with facilities">
    <meta name="keywords" content="healthcare, staffing, medical professionals, nurses, doctors">
    <meta name="robots" content="index, follow">
    <title>Nocturnal - Healthcare Staffing Platform</title>
    <link rel="stylesheet" href="css/index.css">
    <script src="js/config.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">
                <span class="logo-icon">üåô</span>
                <span>Nocturnal</span>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-outline" onclick="showLoginOptions()" style="position: relative;">
                    Login
                    <div id="loginDropdown" style="display: none; position: absolute; top: 100%; right: 0; background: white; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); margin-top: 10px; min-width: 180px; z-index: 1000;">
                        <a href="patient-login.html" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;">Patient Login</a>
                        <a href="provider-login.html" style="display: block; padding: 12px 20px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;">Provider Login</a>
                        <a href="#" onclick="event.preventDefault(); openLoginModal(); hideLoginOptions();" style="display: block; padding: 12px 20px; color: #333; text-decoration: none;">Staff Login</a>
                    </div>
                </button>
                <button class="btn btn-primary" onclick="window.location.href='patient-register.html'">Book Service</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>it's time for something better</h1>

            <div class="benefits-grid">
                <div class="benefits-column">
                    <h3>For Patients</h3>
                    <ul>
                        <li>professional nurses & physiotherapists at your doorstep</li>
                        <li>book services in minutes - from injections to physiotherapy</li>
                        <li>transparent pricing with secure payment - no hidden charges</li>
                    </ul>
                    <button class="btn btn-primary" onclick="window.location.href='patient-register.html'" style="margin-top: 15px;">Book a Service</button>
                </div>
                <div class="benefits-column">
                    <h3>For Healthcare Professionals</h3>
                    <ul>
                        <li>be your own boss & take back control</li>
                        <li>set your rates, preferences & choose the shifts that suit you</li>
                        <li>say goodbye to time-consuming admin, paper timesheets & agency mistakes</li>
                    </ul>
                    <button class="btn btn-outline" onclick="openRegisterModal()" style="margin-top: 15px;">Join as Provider</button>
                </div>
                <div class="benefits-column">
                    <h3>For Healthcare Facilities</h3>
                    <ul>
                        <li>keep your digital profile & compliance up-to-date and secure</li>
                        <li>one-click apply to hundreds of shifts across the country</li>
                        <li>get paid on time, every time - timesheets submitted, tracked & approved online</li>
                    </ul>
                    <button class="btn btn-outline" onclick="openRegisterModal()" style="margin-top: 15px;">Register Facility</button>
                </div>
            </div>

            <div class="mission-statement">
                <p>Our online marketplace directly connects primary and urgent care professionals with service providers and shifts without the need for recruitment agencies.</p>
                <p>We give power back to healthcare professionals by cutting out recruiters and exploitative agency fees.</p>
            </div>

            <div class="cta-button">
                <button class="btn btn-primary btn-lg" onclick="openRegisterModal()" style="font-size: 1.1rem; padding: 15px 40px;">find out more</button>
            </div>
        </div>
    </section>

    <!-- Patient Services Section -->
    <section class="patient-services" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 60px 20px;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 2rem; color: white;">Healthcare Services at Your Doorstep</h2>
            <p style="text-align: center; margin-bottom: 40px; font-size: 1.1rem; opacity: 0.95;">Professional nurses and physiotherapists available 24/7</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üíâ</div>
                    <h3 style="margin-bottom: 10px; color: white;">Nursing Services</h3>
                    <p style="opacity: 0.9; font-size: 0.95rem;">IM/IV Injections, Wound Dressing, Catheter Care, Post-Surgery Care</p>
                </div>
                <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üßò</div>
                    <h3 style="margin-bottom: 10px; color: white;">Physiotherapy</h3>
                    <p style="opacity: 0.9; font-size: 0.95rem;">Pain Management, Rehab, Stroke Recovery, Sports Injuries</p>
                </div>
                <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üë¥</div>
                    <h3 style="margin-bottom: 10px; color: white;">Elderly Care</h3>
                    <p style="opacity: 0.9; font-size: 0.95rem;">Daily Care, Medication Management, Monitoring & Support</p>
                </div>
                <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üì¶</div>
                    <h3 style="margin-bottom: 10px; color: white;">Care Packages</h3>
                    <p style="opacity: 0.9; font-size: 0.95rem;">10-Session Physio, Monthly Elderly Care, Recovery Plans</p>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="window.location.href='patient-register.html'" style="background: white; color: #667eea; font-size: 1.1rem; padding: 15px 40px; border: none;">Browse All Services</button>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section class="how-it-works">
        <h2>how it works</h2>
        <div class="steps-container">
            <div class="step">
                <div class="step-icon">üë§</div>
                <h3>Create Your Profile</h3>
                <p>Sign up and build your professional profile with your experience, skills and credentials</p>
            </div>
            <div class="step">
                <div class="step-icon">üì±</div>
                <h3>Browse & Apply</h3>
                <p>Find shifts that match your preferences and apply with just one click</p>
            </div>
            <div class="step">
                <div class="step-icon">üíº</div>
                <h3>Get Hired</h3>
                <p>Facilities review your profile and accept your application for the perfect match</p>
            </div>
            <div class="step">
                <div class="step-icon">üí∞</div>
                <h3>Get Paid</h3>
                <p>Complete your shift and receive payment directly - no middleman, no delays</p>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="features-container">
            <div class="feature-block">
                <div class="feature-content">
                    <h3>Sing your own praises.</h3>
                    <p>Tell service providers about your experience, skills and professional interests directly, with no unnecessary middle-man.</p>
                </div>
                <div class="feature-visual">
                    <div class="feature-visual-content">üìã</div>
                </div>
            </div>

            <div class="feature-block" style="direction: rtl;">
                <div class="feature-content" style="direction: ltr;">
                    <h3>Have control.</h3>
                    <p>Agree your own shifts and rates of pay based on your preferences and availability.</p>
                </div>
                <div class="feature-visual">
                    <div class="feature-visual-content">üéØ</div>
                </div>
            </div>

            <div class="feature-block">
                <div class="feature-content">
                    <h3>Earn more.</h3>
                    <p>No more agencies means you receive <span class="highlight">100% of your agreed rate</span> - up to <span class="highlight">20% more</span> than you would with an agency.</p>
                </div>
                <div class="feature-visual">
                    <div class="feature-visual-content">üí∏</div>
                </div>
            </div>

            <div class="quote-section">
                <h2>"turbo-charging a digital revolution within healthcare staffing"</h2>
                <p>‚Äî Digital Innovation Director</p>
            </div>

            <div class="feature-block" style="direction: rtl;">
                <div class="feature-content" style="direction: ltr;">
                    <h3>simple and easy to use on any device</h3>
                    <p>We connect healthcare professionals with regular, high-paying work via our <span class="highlight">transparent</span> and <span class="highlight">easy to use</span> platform</p>
                    <p>Find shifts that are <span class="highlight">perfect</span> for you in just a few clicks</p>
                    <p>Forget paper timesheets - hours worked are auto-approved and submitted for payment <span class="highlight">instantly</span> so you always get paid on time</p>
                </div>
                <div class="feature-visual">
                    <div class="feature-visual-content">üì≤</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Get Started Section -->
    <section class="get-started">
        <div class="get-started-content">
            <h2>get started</h2>
            <div class="requirements">
                <p>To find and book shifts with Nocturnal you must be allowed to work in the UK, have worked as a GP or registered Nurse (RGN or RMN) for at least one year and have up-to-date documents.</p>
            </div>
            <p style="font-weight: 600; margin-top: 30px;">that's it.</p>
            <p style="margin-top: 20px;">Nocturnal has nationwide coverage and is working with many of the best known primary and urgent care providers, GP federations, social care providers and care homes in both the NHS and private sector.</p>
            <p class="bold-text">got all your documentation to hand? you can start booking shifts today.</p>
            <button class="btn btn-primary btn-lg" onclick="openRegisterModal()" style="font-size: 1.1rem; padding: 15px 40px; margin-top: 20px;">get started</button>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="social-links">
            <a href="#" title="Facebook">üìò</a>
            <a href="#" title="LinkedIn">üíº</a>
            <a href="#" title="Twitter">üê¶</a>
        </div>
        <div class="footer-links">
            <a href="#" onclick="alert('Help Center coming soon'); return false;">HELP CENTER</a>
            <a href="#" onclick="alert('Careers page coming soon'); return false;">CAREERS</a>
            <a href="#" onclick="alert('Privacy Policy coming soon'); return false;">PRIVACY</a>
            <a href="#" onclick="alert('Terms of Use coming soon'); return false;">TERMS OF USE</a>
            <a href="#" onclick="alert('Contact page coming soon'); return false;">CONTACT</a>
        </div>
        <p style="margin-top: 20px;">&copy; 2025 Nocturnal. All rights reserved.</p>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeLoginModal()">&times;</button>
            <h2>Welcome Back</h2>
            <div id="loginError"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
            <div class="modal-footer">
                <p>Don't have an account? <a onclick="closeLoginModal(); openRegisterModal();">Sign up</a></p>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeRegisterModal()">&times;</button>
            <h2>Get Started</h2>
            <div id="registerError"></div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName">Full Name</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="registerRole">I am a...</label>
                    <select id="registerRole" required>
                        <option value="">Select your role</option>
                        <option value="doctor">Doctor / GP</option>
                        <option value="nurse">Nurse (RGN/RMN)</option>
                        <option value="admin">Hospital Administrator</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Create Account</button>
            </form>
            <div class="modal-footer">
                <p>Already have an account? <a onclick="closeRegisterModal(); openLoginModal();">Login</a></p>
            </div>
        </div>
    </div>

    <!-- JWT-based Authentication (Firebase removed for security) -->
    <script>
        // Check if user is already logged in
        window.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            if (token) {
                try {
                    // Verify token with backend
                    const response = await fetch('http://localhost:5000/api/auth/me', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    const data = await response.json();

                    if (data.success && data.user) {
                        const userData = data.user;
                        localStorage.setItem('user', JSON.stringify(userData));

                        if (userData.role === 'doctor' || userData.role === 'nurse') {
                            if (userData.onboardingCompleted) {
                                window.location.href = 'doctor-dashboard.html';
                            } else {
                                window.location.href = 'doctor-onboarding.html';
                            }
                        } else if (userData.role === 'admin') {
                            window.location.href = 'admin-dashboard.html';
                        }
                    } else {
                        // Token invalid, clear it
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                    }
                } catch (error) {
                    console.log('No valid session');
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                }
            }
        });

        // Login Form Handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const errorDiv = document.getElementById('loginError');
            errorDiv.innerHTML = '';

            btn.classList.add('loading');

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                // Login using secure JWT-based backend API
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (data.success && data.token) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));

                    if (data.user.role === 'doctor' || data.user.role === 'nurse') {
                        localStorage.setItem('userType', 'doctor');
                        // Check if onboarding is completed
                        if (data.user.onboardingCompleted) {
                            window.location.href = 'doctor-dashboard.html';
                        } else {
                            window.location.href = 'doctor-onboarding.html';
                        }
                    } else if (data.user.role === 'admin') {
                        localStorage.setItem('userType', 'hospital');
                        window.location.href = 'admin-dashboard.html';
                    }
                } else {
                    throw new Error(data.message || 'Login failed');
                }
            } catch (error) {
                console.error('Login error:', error);
                errorDiv.innerHTML = '<div class="error-message">Invalid email or password. Please try again.</div>';
                btn.classList.remove('loading');
            }
        });

        // Register Form Handler
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const errorDiv = document.getElementById('registerError');
            errorDiv.innerHTML = '';

            btn.classList.add('loading');

            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const role = document.getElementById('registerRole').value;

            try {
                // Register using secure JWT-based backend API
                const response = await fetch('http://localhost:5000/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password, role })
                });

                const data = await response.json();

                if (data.success && data.token) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));

                    if (role === 'doctor' || role === 'nurse') {
                        localStorage.setItem('userType', 'doctor');
                        window.location.href = 'doctor-onboarding.html';
                    } else if (role === 'admin') {
                        localStorage.setItem('userType', 'hospital');
                        window.location.href = 'admin-dashboard.html';
                    }
                } else {
                    throw new Error(data.message || 'Registration failed');
                }
            } catch (error) {
                console.error('Registration error:', error);
                let errorMessage = 'Registration failed. Please try again.';
                if (error.message && error.message.includes('already exists')) {
                    errorMessage = 'This email is already registered. Please login instead.';
                } else if (error.message && error.message.includes('password')) {
                    errorMessage = 'Password must be at least 8 characters with uppercase, lowercase, number, and special character.';
                }
                errorDiv.innerHTML = `<div class="error-message">${errorMessage}</div>`;
                btn.classList.remove('loading');
            }
        });
    </script>

    <script>
        // Login Dropdown Functions
        function showLoginOptions() {
            const dropdown = document.getElementById('loginDropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function hideLoginOptions() {
            document.getElementById('loginDropdown').style.display = 'none';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('loginDropdown');
            const loginBtn = event.target.closest('button');

            if (!loginBtn || !loginBtn.textContent.includes('Login')) {
                dropdown.style.display = 'none';
            }
        });

        // Modal Functions
        function openLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('loginError').innerHTML = '';
        }

        function openRegisterModal() {
            // Redirect to unified landing page for registration
            window.location.href = 'index-unified.html';
        }

        function closeRegisterModal() {
            document.getElementById('registerModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('registerError').innerHTML = '';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const loginModal = document.getElementById('loginModal');
            const registerModal = document.getElementById('registerModal');
            if (event.target === loginModal) {
                closeLoginModal();
            }
            if (event.target === registerModal) {
                closeRegisterModal();
            }
        }
    </script>
</body>
</html>
